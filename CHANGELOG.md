# Changelog

## [Unreleased] - 2024

### Добавлено

#### Функционал смены пароля
- Добавлена страница настроек профиля (`/settings`)
- Реализована форма смены пароля с валидацией:
  - Проверка текущего пароля
  - Требование минимум 8 символов для нового пароля
  - Подтверждение нового пароля
  - Проверка, что новый пароль отличается от текущего
- Добавлены маршруты:
  - `GET /settings` - главная страница настроек
  - `GET /settings/change-password` - форма смены пароля
  - `POST /settings/change-password` - обработка смены пароля
- Добавлены ссылки на настройки в меню пользователя (десктоп и мобильная версия)
- Добавлена статистика пользователя на странице настроек

#### Контроллер настроек
- Расширен `SettingsController` методами:
  - `index()` - отображение главной страницы настроек
  - `showChangePasswordForm()` - форма смены пароля
  - `changePassword()` - обработка изменения пароля

#### Представления
- `resources/views/settings/index.blade.php` - главная страница настроек профиля
- `resources/views/settings/change-password.blade.php` - форма смены пароля

### Исправлено

#### Меню действий в таблице активных заявок
- Исправлен `colspan` с 6 на 7 в пустой таблице заявок (строка 509)
- Добавлена колонка "Действия" в функцию `createTechTicketRowHTML()`:
  - Кнопка меню из трёх точек
  - Выпадающее меню с действиями (Просмотр заявки, Взять в работу)
  - Правильное позиционирование меню
- Меню теперь корректно отображается и не ломает layout таблицы

#### Инициализация выпадающих меню
- Улучшена инициализация обработчиков выпадающих меню после обновления данных через AJAX
- Добавлены callback'и `onItemUpdate` и `onItemAdd` в SmartUpdates для переинициализации меню

### Технические детали

#### Безопасность
- Валидация паролей с использованием `Illuminate\Validation\Rules\Password`
- Хеширование паролей через `Hash::make()`
- Проверка текущего пароля через `Hash::check()`
- Защита от использования одинаковых старого и нового паролей

#### UI/UX
- Добавлены иконки для визуального улучшения интерфейса
- Реализована возможность показа/скрытия пароля при вводе
- Добавлены рекомендации по созданию надежного пароля
- Улучшены сообщения об ошибках валидации
- Адаптивный дизайн для мобильных устройств

#### Структура кода
- Следование принципам Laravel (MVC)
- Использование middleware для защиты маршрутов
- Локализованные сообщения валидации на русском языке
- Использование Blade-шаблонов для представлений

### Маршруты

```php
// Настройки профиля (требуется аутентификация)
GET  /settings                    - Главная страница настроек
GET  /settings/change-password    - Форма смены пароля
POST /settings/change-password    - Обработка смены пароля
```

### Использование

#### Смена пароля
1. Войдите в систему
2. Нажмите на иконку пользователя в правом верхнем углу
3. Выберите "Настройки"
4. В разделе "Безопасность" нажмите "Изменить пароль"
5. Введите текущий пароль
6. Введите новый пароль (минимум 8 символов)
7. Подтвердите новый пароль
8. Нажмите "Изменить пароль"

#### Просмотр информации профиля
1. Перейдите в настройки профиля
2. Просмотрите:
   - Личную информацию (имя, телефон, роль, статус)
   - Дату регистрации и последнего входа
   - Статистику по заявкам

### Зависимости
- Laravel 10.x
- Tailwind CSS (для стилизации)
- Alpine.js или vanilla JS (для интерактивности)

---

## Примечания для разработчиков

### Файлы изменений

**Контроллеры:**
- `app/Http/Controllers/SettingsController.php` - добавлены методы для настроек

**Маршруты:**
- `routes/web.php` - добавлены маршруты для настроек профиля

**Представления:**
- `resources/views/settings/index.blade.php` - создан
- `resources/views/settings/change-password.blade.php` - создан
- `resources/views/layouts/app.blade.php` - обновлено меню пользователя
- `resources/views/home.blade.php` - исправлена таблица активных заявок

**JavaScript:**
- `resources/views/home.blade.php` - обновлена функция `createTechTicketRowHTML()`

### Тестирование

Рекомендуется протестировать:
1. ✅ Смену пароля с корректными данными
2. ✅ Ошибку при неверном текущем пароле
3. ✅ Ошибку при несовпадении нового пароля и подтверждения
4. ✅ Ошибку при попытке установить тот же пароль
5. ✅ Ошибку при пароле короче 8 символов
6. ✅ Отображение меню действий в таблице активных заявок
7. ✅ Работу выпадающего меню после обновления данных через AJAX
8. ✅ Отображение на мобильных устройствах