# üîß –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram –±–æ—Ç–µ

## üêõ **–ü—Ä–æ–±–ª–µ–º–∞:**
Telegram –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–≤–æ–π–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∑—è—Ç–∏–∏ –∑–∞—è–≤–∫–∏ –≤ —Ä–∞–±–æ—Ç—É, –Ω–æ –∏ –≤ –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞—è—Ö.

## üîç **–ü—Ä–∏—á–∏–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**

### 1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:**
- `TelegramStandalone` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ `sendMessage()`
- `TelegramBotController` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ `botman->say()`
- `NotificationService` - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ–±–µ —Å–∏—Å—Ç–µ–º—ã

### 2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏:**
- –í Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏ `TelegramStandalone`, –∏ `NotificationService`
- `NotificationService` –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å `TelegramBotController`
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π

## ‚úÖ **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**

### 1. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ NotificationService –≤ Docker**
```php
// –í NotificationService –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
if (env('LARAVEL_SAIL')) {
    Log::info("Telegram notification skipped in Docker environment");
    return;
}
```

### 2. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ TelegramStandalone**
```php
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
$messageHash = md5($chatId . $text);
$cacheKey = "telegram_message_sent_{$messageHash}";

if (Cache::has($cacheKey)) {
    Log::warning("Duplicate message prevented");
    return;
}

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ö–µ—à —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
Cache::put($cacheKey, true, 30);
```

### 3. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≤ TelegramBotController**
```php
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ BotMan —Å–æ–æ–±—â–µ–Ω–∏–π
$messageHash = md5($user->telegram_id . $message);
$cacheKey = "telegram_botman_message_sent_{$messageHash}";

if (Cache::has($cacheKey)) {
    Log::warning("Duplicate BotMan message prevented");
    continue;
}

// –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ö–µ—à —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
Cache::put($cacheKey, true, 30);
```

### 4. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏**
```php
// –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –≤ NotificationService
public function sendTelegramNotification($chatId, $message, $params = [])
{
    // –í Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if (env('LARAVEL_SAIL')) {
        Log::info("Telegram notification skipped in Docker environment");
        return;
    }
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –≤ –æ–±—ã—á–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
}
```

## üéØ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**

### 1. **–£—Ä–æ–≤–µ–Ω—å –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- –í Docker: —Ç–æ–ª—å–∫–æ `TelegramStandalone` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- –í –æ–±—ã—á–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏: —Ç–æ–ª—å–∫–æ `TelegramBotController` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

### 2. **–£—Ä–æ–≤–µ–Ω—å —Å–æ–æ–±—â–µ–Ω–∏–π:**
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ö–µ—à
- –•–µ—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫–µ—à–µ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–µ–º –∂–µ —Ö–µ—à–µ–º –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è

### 3. **–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

## üöÄ **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Telegram –±–æ—Ç–∞:
```bash
./vendor/bin/sail restart telegram-bot
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
./vendor/bin/sail logs telegram-bot -f
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```
/start_ticket_2
/resolve_2
/tickets
/active
```

## üîç **–ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:**

### ‚úÖ **–ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
```
[INFO] TelegramStandalone sendMessage called {"chat_id":123,"message_hash":"abc123"}
[INFO] Successfully sent message
```

### ‚ö†Ô∏è **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
[WARNING] Duplicate message prevented {"chat_id":123,"message_hash":"abc123"}
[WARNING] Duplicate BotMan message prevented {"user_id":1,"message_hash":"abc123"}
```

### üö´ **–û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Docker:**
```
[INFO] Telegram notification skipped in Docker environment {"chat_id":123}
```

## üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

### –ö–ª—é—á–µ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- `TelegramStandalone sendMessage called` - –∫–∞–∂–¥–æ–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `Duplicate message prevented` - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `Telegram notification skipped in Docker environment` - –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `Successfully sent message` - —É—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –í Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ `TelegramStandalone`

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

### ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö

### üîß **–£–ª—É—á—à–µ–Ω–æ:**
- –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏

## üö® **–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**

1. **–ö–µ—à —Å–æ–æ–±—â–µ–Ω–∏–π** –æ—á–∏—â–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
2. **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
4. **–û–∫—Ä—É–∂–µ–Ω–∏–µ** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

**–¢–µ–ø–µ—Ä—å Telegram –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∏ –≤ –∫–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö! üéâ**
