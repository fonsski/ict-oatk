# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è WebSocket —Å–∏—Å—Ç–µ–º—ã

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏ Laravel –∏ WebSocket —Å–µ—Ä–≤–µ—Ä–æ–º**
   - –°–æ–±—ã—Ç–∏—è `TicketCreated`, `TicketStatusChanged`, `TicketAssigned` –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≤–µ–±-—Å–æ–∫–µ—Ç—ã
   - WebSocket —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–ª –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Ç Laravel –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ –≤–µ–±-—Å–æ–∫–µ—Ç—ã**
   - –ù–µ –±—ã–ª–æ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏ Laravel –∏ WebSocket —Å–µ—Ä–≤–µ—Ä–æ–º

3. **WebSocket —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–≥ –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è broadcast**
   - –ù–µ –±—ã–ª–æ —Å–ø–æ—Å–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º –∏–∑ Laravel –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

4. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –ù–µ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç WebSocket —Å–µ—Ä–≤–µ—Ä–∞

## ‚úÖ –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω WebSocketNotificationListener
**–§–∞–π–ª:** `app/Listeners/WebSocketNotificationListener.php`

- –°–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è Laravel (`TicketCreated`, `TicketStatusChanged`, `TicketAssigned`)
- –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è WebSocket
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è broadcast

### 2. –û–±–Ω–æ–≤–ª–µ–Ω WebSocketServer
**–§–∞–π–ª:** `app/WebSocket/WebSocketServer.php`

- –î–æ–±–∞–≤–ª–µ–Ω HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–µ–º–∞ broadcast –∑–∞–ø—Ä–æ—Å–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω endpoint `/broadcast` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Laravel
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω singleton pattern –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–∫–∑–µ–º–ø–ª—è—Ä—É —Å–µ—Ä–≤–µ—Ä–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### 3. –û–±–Ω–æ–≤–ª–µ–Ω EventServiceProvider
**–§–∞–π–ª:** `app/Providers/EventServiceProvider.php`

- –î–æ–±–∞–≤–ª–µ–Ω `WebSocketNotificationListener` –∫ —Å–æ–±—ã—Ç–∏—è–º –∑–∞—è–≤–æ–∫
- –¢–µ–ø–µ—Ä—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –∑–∞—è–≤–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket

### 4. –£–ª—É—á—à–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å
**–§–∞–π–ª:** `resources/js/live-updates.js`

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback –∫ HTTP polling

### 5. –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `config/app.php`

- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `websocket_host` –∏ `websocket_port`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è `WEBSOCKET_HOST` –∏ `WEBSOCKET_PORT`

### 6. –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
**–§–∞–π–ª:** `composer.json`

- –î–æ–±–∞–≤–ª–µ–Ω `ratchet/ratchet` –¥–ª—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞
- –î–æ–±–∞–≤–ª–µ–Ω `react/http` –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫—É –≤ Laravel
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `TicketCreated`
   - `WebSocketNotificationListener` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è HTTP –∑–∞–ø—Ä–æ—Å –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
   - WebSocket —Å–µ—Ä–≤–µ—Ä broadcast —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º

2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏:**
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è `TicketStatusChanged` –∏ `TicketAssigned`

3. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å:**
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
   - –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
```env
WEBSOCKET_HOST=localhost
WEBSOCKET_PORT=8080
```

### Docker Compose
WebSocket —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `websocket-server` –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:
```bash
./vendor/bin/sail up -d
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
```bash
php test-websocket.php
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –¢–µ—Å—Ç —Å–µ—Ä–≤–µ—Ä–∞
curl http://localhost:8080/test

# –û—Ç–ø—Ä–∞–≤–∫–∞ broadcast —Å–æ–æ–±—â–µ–Ω–∏—è
curl -X POST http://localhost:8080/broadcast \
  -H 'Content-Type: application/json' \
  -d '{"message":{"type":"test","data":{"message":"Hello World"}}}'
```

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã: `./vendor/bin/sail up -d`
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–í—Å–µ –∑–∞—è–≤–∫–∏" –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É –≤ –¥—Ä—É–≥–æ–º –æ–∫–Ω–µ/–≤–∫–ª–∞–¥–∫–µ
4. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π WebSocket

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ Laravel
```bash
./vendor/bin/sail logs laravel.test
```

### –õ–æ–≥–∏ WebSocket —Å–µ—Ä–≤–µ—Ä–∞
```bash
./vendor/bin/sail logs websocket-server
```

### –õ–æ–≥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools ‚Üí Console –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π WebSocket

## üîÑ Fallback –º–µ—Ö–∞–Ω–∏–∑–º

–ï—Å–ª–∏ WebSocket –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ HTTP polling:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
- –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
